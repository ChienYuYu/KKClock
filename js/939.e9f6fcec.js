"use strict";(self["webpackChunkkkclock"]=self["webpackChunkkkclock"]||[]).push([[939],{939:function(t,o,e){e.r(o),e.d(o,{default:function(){return it}});var n=e(3396),a=e(7139);const s={class:"container"},l={class:"my-4 d-flex justify-content-between"},i=(0,n._)("h2",null,"優惠券管理",-1),p=(0,n._)("i",{class:"bi bi-bag-plus-fill me-2"},null,-1),u=(0,n.Uk)("新增優惠券  "),d=[p,u],c={class:"table"},r=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{scope:"col"},"名稱"),(0,n._)("th",{scope:"col"},"優惠碼"),(0,n._)("th",{scope:"col"},"折扣百分比"),(0,n._)("th",{scope:"col"},"到期日"),(0,n._)("th",{scope:"col"},"是否啟用"),(0,n._)("th",{scope:"col"},"編輯/刪除")])],-1),m={scope:"row"},h={key:0,class:"text-success"},b={key:1,class:"text-danger"},_={class:"btn-group",role:"group","aria-label":"Basic example"},g=["onClick"],C=["onClick"];function w(t,o,e,p,u,w){const y=(0,n.up)("LoadingPlugin"),v=(0,n.up)("CouponModal"),f=(0,n.up)("DeleteCouponModal"),x=(0,n.up)("Pagination");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(y,{active:u.isLoading},null,8,["active"]),(0,n._)("div",s,[(0,n._)("div",l,[i,(0,n._)("button",{type:"button",class:"btn btn-dark text-warning",onClick:o[0]||(o[0]=t=>w.openModal(!0))},d)]),(0,n._)("table",c,[r,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(u.coupons,(t=>((0,n.wg)(),(0,n.iD)("tr",{key:t.id},[(0,n._)("td",m,(0,a.zw)(t.title),1),(0,n._)("td",null,(0,a.zw)(t.code),1),(0,n._)("td",null,(0,a.zw)(t.percent)+"%",1),(0,n._)("td",null,(0,a.zw)(new Date(t.due_date).toLocaleDateString()),1),(0,n._)("td",null,[1===t.is_enabled?((0,n.wg)(),(0,n.iD)("span",h,"啟用")):((0,n.wg)(),(0,n.iD)("span",b,"未啟用"))]),(0,n._)("td",null,[(0,n._)("div",_,[(0,n._)("button",{type:"button",class:"btn btn-primary text-white",onClick:o=>w.openModal(!1,t)}," 編輯 ",8,g),(0,n._)("button",{type:"button",class:"btn btn-danger text-white",onClick:o=>w.openDelModal(t)}," 刪除 ",8,C)])])])))),128))])])]),(0,n.Wm)(v,{ref:"couponModal",coupon:u.tempCoupon,onUpdateCoupon:w.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,n.Wm)(f,{ref:"delCouponModal",coupon:u.tempCoupon,onDeleteCoupon:w.delCoupon},null,8,["coupon","onDeleteCoupon"]),(0,n.Wm)(x,{pages:u.pagination,onPrePage:w.getCoupons,onPageNum:w.getCoupons,onNextPage:w.getCoupons},null,8,["pages","onPrePage","onPageNum","onNextPage"])],64)}var y=e(9242);const v={class:"modal",tabindex:"-1",ref:"modal"},f={class:"modal-dialog"},x={class:"modal-content"},k=(0,n._)("div",{class:"modal-header"},[(0,n._)("h5",{class:"modal-title"},"優惠券管理"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),D={class:"modal-body"},M={class:"input-group mb-3"},$=(0,n._)("span",{class:"input-group-text"},"優惠券",-1),P={class:"input-group mb-3"},N=(0,n._)("span",{class:"input-group-text"},"優惠碼",-1),U={class:"input-group mb-3"},L=(0,n._)("span",{class:"input-group-text"},"折扣",-1),Z=(0,n._)("span",{class:"input-group-text"},"%",-1),z={class:"input-group mb-3"},V=(0,n._)("span",{class:"input-group-text"},"到期日",-1),B={class:"form-check"},W={class:"form-check-label",for:"enableCoupon"},j=(0,n.Uk)(" 啟用 "),S={class:"modal-footer"},T=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function H(t,o,e,a,s,l){return(0,n.wg)(),(0,n.iD)("div",v,[(0,n._)("div",f,[(0,n._)("div",x,[k,(0,n._)("div",D,[(0,n._)("div",M,[$,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",placeholder:"輸入優惠券名稱","aria-label":"CouponName","onUpdate:modelValue":o[0]||(o[0]=t=>s.tempCoupon.title=t)},null,512),[[y.nr,s.tempCoupon.title]])]),(0,n._)("div",P,[N,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",placeholder:"輸入優惠碼","aria-label":"CouponCode","onUpdate:modelValue":o[1]||(o[1]=t=>s.tempCoupon.code=t)},null,512),[[y.nr,s.tempCoupon.code]])]),(0,n._)("div",U,[L,(0,n.wy)((0,n._)("input",{type:"number",class:"form-control","aria-label":"Discount",min:"0","onUpdate:modelValue":o[2]||(o[2]=t=>s.tempCoupon.percent=t)},null,512),[[y.nr,s.tempCoupon.percent]]),Z]),(0,n._)("div",z,[V,(0,n.wy)((0,n._)("input",{type:"date",class:"form-control","aria-label":"Date","onUpdate:modelValue":o[3]||(o[3]=t=>s.due_date=t)},null,512),[[y.nr,s.due_date]])]),(0,n._)("div",B,[(0,n._)("label",W,[j,(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox",id:"enableCoupon","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=t=>s.tempCoupon.is_enabled=t)},null,512),[[y.e8,s.tempCoupon.is_enabled]])])])]),(0,n._)("div",S,[T,(0,n._)("button",{type:"button",class:"btn btn-primary text-white",onClick:o[5]||(o[5]=o=>t.$emit("update-coupon",s.tempCoupon))}," 確認 ")])])])],512)}var Y=e(1339),I={props:["coupon"],data(){return{modal:{},tempCoupon:{},due_date:""}},mixins:[Y.Z],watch:{coupon(){this.tempCoupon=this.coupon,this.due_date=(new Date).toISOString().split("T")},due_date(){this.tempCoupon.due_date=new Date(this.due_date).getTime()}}},K=e(89);const O=(0,K.Z)(I,[["render",H]]);var q=O;const A={class:"modal",tabindex:"-1",ref:"modal"},E={class:"modal-dialog"},F={class:"modal-content border-0"},G=(0,n._)("div",{class:"modal-header bg-danger"},[(0,n._)("h5",{class:"modal-title text-white"},"刪除"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},Q=(0,n._)("p",{class:"text-danger"},"※ 刪除後無法復原!",-1),R={class:"modal-footer"},X=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function tt(t,o,e,s,l,i){return(0,n.wg)(),(0,n.iD)("div",A,[(0,n._)("div",E,[(0,n._)("div",F,[G,(0,n._)("div",J,[(0,n._)("p",null,"刪除【"+(0,a.zw)(e.coupon.title)+"】此優惠券?",1),Q]),(0,n._)("div",R,[X,(0,n._)("button",{type:"button",class:"btn btn-danger text-white",onClick:o[0]||(o[0]=o=>t.$emit("delete-coupon",e.coupon))}," 確認 ")])])])],512)}var ot={props:["coupon"],mixins:[Y.Z]};const et=(0,K.Z)(ot,[["render",tt]]);var nt=et,at=e(2151),st={components:{CouponModal:q,DeleteCouponModal:nt,Pagination:at.Z},inject:["emitter"],data(){return{isLoading:!1,coupons:[],tempCoupon:{},isNew:!1,pagination:{}}},methods:{getCoupons(t=1){const o=`https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupons?page=${t}`;this.isLoading=!0,this.axios.get(o).then((t=>{this.coupons=t.data.coupons,this.pagination=t.data.pagination,this.isLoading=!1})).catch((()=>{this.$swal({title:"似乎有些問題 請稍後再嘗試",icon:"error",showConfirmButton:!1,timer:2e3}),this.isLoading=!1}))},openModal(t,o){this.$refs.couponModal.showModal(),this.isNew=t,this.tempCoupon=!0===t?{is_enabled:1,due_date:(new Date).getTime()}:{...o}},updateCoupon(t){let o="https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupon",e="post";!1===this.isNew&&(o=`https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupon/${t.id}`,e="put"),this.axios[e](o,{data:t}).then((t=>{this.$refs.couponModal.hideModal(),t.data.success?(this.getCoupons(),this.emitter.emit("push-message",{style:"mygreen",title:this.isNew?"新增成功":"更新成功"})):this.emitter.emit("push-message",{style:"myred",title:this.isNew?"新增失敗":"更新失敗",content:t.data.message.join("、")})})).catch((()=>{this.$swal({title:"似乎有些問題 請稍後再嘗試",icon:"error",showConfirmButton:!1,timer:2e3})}))},openDelModal(t){this.$refs.delCouponModal.showModal(),this.tempCoupon={...t}},delCoupon(t){const o=`https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupon/${t.id}`;this.axios.delete(o).then((()=>{this.$refs.delCouponModal.hideModal(),this.getCoupons(),this.emitter.emit("push-message",{style:"mygreen",title:"刪除成功"})})).catch((()=>{this.$swal({title:"似乎有些問題 請稍後再嘗試",icon:"error",showConfirmButton:!1,timer:2e3})}))}},created(){this.getCoupons()}};const lt=(0,K.Z)(st,[["render",w]]);var it=lt}}]);
//# sourceMappingURL=939.e9f6fcec.js.map