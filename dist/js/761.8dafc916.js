"use strict";(self["webpackChunkkkclock"]=self["webpackChunkkkclock"]||[]).push([[761],{7761:function(e,t,o){o.r(t),o.d(t,{default:function(){return ie}});var n=o(3396),a=o(7139);const s={class:"container"},l={class:"my-4 d-flex justify-content-between"},i=(0,n._)("h2",null,"優惠券管理",-1),p=(0,n._)("i",{class:"bi bi-bag-plus-fill me-2"},null,-1),u=(0,n.Uk)("新增優惠券  "),d=[p,u],c={class:"table"},r=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{scope:"col"},"名稱"),(0,n._)("th",{scope:"col"},"優惠碼"),(0,n._)("th",{scope:"col"},"折扣百分比"),(0,n._)("th",{scope:"col"},"到期日"),(0,n._)("th",{scope:"col"},"是否啟用"),(0,n._)("th",{scope:"col"},"編輯/刪除")])],-1),m={scope:"row"},h={key:0,class:"text-success"},b={key:1,class:"text-danger"},_={class:"btn-group",role:"group","aria-label":"Basic example"},g=["onClick"],C=["onClick"];function y(e,t,o,p,u,y){const w=(0,n.up)("LoadingPlugin"),v=(0,n.up)("CouponModal"),x=(0,n.up)("DeleteCouponModal"),f=(0,n.up)("Pagination");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(w,{active:u.isLoading},null,8,["active"]),(0,n._)("div",s,[(0,n._)("div",l,[i,(0,n._)("button",{type:"button",class:"btn btn-dark text-warning",onClick:t[0]||(t[0]=e=>y.openModal(!0))},d)]),(0,n._)("table",c,[r,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(u.coupons,(e=>((0,n.wg)(),(0,n.iD)("tr",{key:e.id},[(0,n._)("td",m,(0,a.zw)(e.title),1),(0,n._)("td",null,(0,a.zw)(e.code),1),(0,n._)("td",null,(0,a.zw)(e.percent)+"%",1),(0,n._)("td",null,(0,a.zw)(new Date(e.due_date).toLocaleDateString()),1),(0,n._)("td",null,[1===e.is_enabled?((0,n.wg)(),(0,n.iD)("span",h,"啟用")):((0,n.wg)(),(0,n.iD)("span",b,"未啟用"))]),(0,n._)("td",null,[(0,n._)("div",_,[(0,n._)("button",{type:"button",class:"btn btn-primary text-white",onClick:t=>y.openModal(!1,e)}," 編輯 ",8,g),(0,n._)("button",{type:"button",class:"btn btn-danger text-white",onClick:t=>y.openDelModal(e)}," 刪除 ",8,C)])])])))),128))])])]),(0,n.Wm)(v,{ref:"couponModal",coupon:u.tempCoupon,onUpdateCoupon:y.updateCoupon},null,8,["coupon","onUpdateCoupon"]),(0,n.Wm)(x,{ref:"delCouponModal",coupon:u.tempCoupon,onDeleteCoupon:y.delCoupon},null,8,["coupon","onDeleteCoupon"]),(0,n.Wm)(f,{pages:u.pagination,onPrePage:y.getCoupons,onPageNum:y.getCoupons,onNextPage:y.getCoupons},null,8,["pages","onPrePage","onPageNum","onNextPage"])],64)}var w=o(9242);const v={class:"modal",tabindex:"-1",ref:"modal"},x={class:"modal-dialog"},f={class:"modal-content"},k=(0,n._)("div",{class:"modal-header"},[(0,n._)("h5",{class:"modal-title"},"優惠券管理"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),M={class:"modal-body"},D={class:"input-group mb-3"},P=(0,n._)("span",{class:"input-group-text"},"優惠券",-1),$={class:"input-group mb-3"},U=(0,n._)("span",{class:"input-group-text"},"優惠碼",-1),N={class:"input-group mb-3"},L=(0,n._)("span",{class:"input-group-text"},"折扣",-1),Z=(0,n._)("span",{class:"input-group-text"},"%",-1),z={class:"input-group mb-3"},V=(0,n._)("span",{class:"input-group-text"},"到期日",-1),j={class:"form-check"},W={class:"form-check-label",for:"enableCoupon"},S=(0,n.Uk)(" 啟用 "),T={class:"modal-footer"},H=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Y(e,t,o,a,s,l){return(0,n.wg)(),(0,n.iD)("div",v,[(0,n._)("div",x,[(0,n._)("div",f,[k,(0,n._)("div",M,[(0,n._)("div",D,[P,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",placeholder:"輸入優惠券名稱","aria-label":"CouponName","onUpdate:modelValue":t[0]||(t[0]=e=>s.tempCoupon.title=e)},null,512),[[w.nr,s.tempCoupon.title]])]),(0,n._)("div",$,[U,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",placeholder:"輸入優惠碼","aria-label":"CouponCode","onUpdate:modelValue":t[1]||(t[1]=e=>s.tempCoupon.code=e)},null,512),[[w.nr,s.tempCoupon.code]])]),(0,n._)("div",N,[L,(0,n.wy)((0,n._)("input",{type:"number",class:"form-control","aria-label":"Discount",min:"0","onUpdate:modelValue":t[2]||(t[2]=e=>s.tempCoupon.percent=e)},null,512),[[w.nr,s.tempCoupon.percent]]),Z]),(0,n._)("div",z,[V,(0,n.wy)((0,n._)("input",{type:"date",class:"form-control","aria-label":"Date","onUpdate:modelValue":t[3]||(t[3]=e=>s.due_date=e)},null,512),[[w.nr,s.due_date]])]),(0,n._)("div",j,[(0,n._)("label",W,[S,(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox",value:"",id:"enableCoupon","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=e=>s.tempCoupon.is_enabled=e)},null,512),[[w.e8,s.tempCoupon.is_enabled]])])])]),(0,n._)("div",T,[H,(0,n._)("button",{type:"button",class:"btn btn-primary text-white",onClick:t[5]||(t[5]=t=>e.$emit("update-coupon",s.tempCoupon))},"確認")])])])],512)}var B=o(1339),I={props:["coupon"],data(){return{modal:{},tempCoupon:{},due_date:""}},mixins:[B.Z],watch:{coupon(){this.tempCoupon=this.coupon,this.due_date=(new Date).toISOString().split("T")},due_date(){this.tempCoupon.due_date=new Date(this.due_date).getTime()}}},K=o(89);const O=(0,K.Z)(I,[["render",Y]]);var q=O;const A={class:"modal",tabindex:"-1",ref:"modal"},E={class:"modal-dialog"},F={class:"modal-content border-0"},G=(0,n._)("div",{class:"modal-header bg-danger"},[(0,n._)("h5",{class:"modal-title text-white"},"刪除"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},Q=(0,n._)("p",{class:"text-danger"},"※ 刪除後無法復原!",-1),R={class:"modal-footer"},X=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function ee(e,t,o,s,l,i){return(0,n.wg)(),(0,n.iD)("div",A,[(0,n._)("div",E,[(0,n._)("div",F,[G,(0,n._)("div",J,[(0,n._)("p",null,"刪除【"+(0,a.zw)(o.coupon.title)+"】此優惠券?",1),Q]),(0,n._)("div",R,[X,(0,n._)("button",{type:"button",class:"btn btn-danger text-white",onClick:t[0]||(t[0]=t=>e.$emit("delete-coupon",o.coupon))},"確認")])])])],512)}var te={props:["coupon"],mixins:[B.Z]};const oe=(0,K.Z)(te,[["render",ee]]);var ne=oe,ae=o(6109),se={components:{CouponModal:q,DeleteCouponModal:ne,Pagination:ae.Z},inject:["emitter"],data(){return{isLoading:!1,coupons:[],tempCoupon:{},isNew:!1,pagination:{}}},methods:{getCoupons(e=1){const t=`https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupons?page=${e}`;this.isLoading=!0,this.axios.get(t).then((e=>{this.isLoading=!1,this.coupons=e.data.coupons,this.pagination=e.data.pagination}))},openModal(e,t){this.$refs.couponModal.showModal(),this.isNew=e,this.tempCoupon=!0===e?{is_enabled:1,due_date:(new Date).getTime()}:{...t}},updateCoupon(e){if(this.isNew){const t="https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupon";this.axios.post(t,{data:e}).then((e=>{this.$refs.couponModal.hideModal(),e.data.success?(this.getCoupons(),this.emitter.emit("push-message",{style:"mygreen",title:"新增成功"})):this.emitter.emit("push-message",{style:"myred",title:"新增失敗",content:e.data.message.join("、")})}))}else{const t=`https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupon/${e.id}`;this.axios.put(t,{data:e}).then((e=>{this.$refs.couponModal.hideModal(),e.data.success?(this.getCoupons(),this.emitter.emit("push-message",{style:"mygreen",title:"更新成功"})):this.emitter.emit("push-message",{style:"myred",title:"更新失敗",content:e.data.message.join("、")})}))}},openDelModal(e){this.$refs.delCouponModal.showModal(),this.tempCoupon={...e}},delCoupon(e){const t=`https://vue3-course-api.hexschool.io/api/chienyu-api/admin/coupon/${e.id}`;this.axios.delete(t).then((()=>{this.$refs.delCouponModal.hideModal(),this.getCoupons(),this.emitter.emit("push-message",{style:"mygreen",title:"刪除成功"})}))}},created(){this.getCoupons()}};const le=(0,K.Z)(se,[["render",y]]);var ie=le}}]);
//# sourceMappingURL=761.8dafc916.js.map